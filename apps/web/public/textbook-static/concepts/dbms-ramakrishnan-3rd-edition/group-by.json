{
  "concept_id": "group-by",
  "title": "The GROUP BY Clause",
  "learning_objectives": [
    "Group rows by one or more columns",
    "Apply aggregate functions to groups",
    "Use HAVING to filter groups based on aggregate values",
    "Understand the execution order of GROUP BY and HAVING"
  ],
  "prerequisite_concepts": [
    "select-basic",
    "aggregate-functions"
  ],
  "practice_problems": [
    "problem-4",
    "problem-13",
    "problem-14"
  ],
  "sections": {
    "definition": {
      "concept_explanation": "154 CHAPTEFt,~5 Relationa~ Algebra and SQL: ~~~~:egation is a fUIl~~~:\u00b7mental operati(~:l-'-l that canIlot be expressed in relational algebra.",
      "visual_diagram": ""
    },
    "examples": [
      {
        "title": "SQL Example 1",
        "difficulty": "advanced",
        "scenario": "Aggregating data for reporting",
        "sql": "SELECT FROM GROUP BY HAVING S.age, AVG (S.age) AS avgage users S S.age 1 < (SELECT COUNT (*) FROM users S2 WHERE S.age = S2.Hl,ting) 6This query can be ea..'iily rewritten to be legal in SQL: 1999 using EVERY in the HAVING clause. 160 CHAPTER .;",
        "explanation": "Example SQL statement",
        "expected_output": "| id | name | email | age | city |\n| --- | --- | --- | --- | --- |\n| 1 | Alice | alice@email.com | 25 | Seattle |\n| 2 | Bob | bob@email.com | 30 | Portland |\n| 3 | Charlie | charlie@email.com | 22 | Seattle |"
      },
      {
        "title": "SQL Example 2",
        "difficulty": "intermediate",
        "scenario": "Aggregating data for reporting",
        "sql": "SELECT FROM WHERE GROUP BY S.age, AVG users S S. age> 18 and age 2 18. Query Q36 is actually very similar to Q32, as the following simpler formulation shows: SELECT FROM WHERE GROUP BY S.age, AVG users S S. age> 18 S.age (S.age) AS avgage SQL: QueTies, Constraints, Triggers HAVING COUNT (*) > 1 This formulation of Q36 takes advantage of the fact that the WHERE clause is applied before grouping is done;",
        "explanation": "Example SQL statement",
        "expected_output": "| id | name | email | age | city |\n| --- | --- | --- | --- | --- |\n| 1 | Alice | alice@email.com | 25 | Seattle |\n| 2 | Bob | bob@email.com | 30 | Portland |\n| 3 | Charlie | charlie@email.com | 22 | Seattle |"
      }
    ],
    "common_mistakes": [
      {
        "title": "Missing column in GROUP BY",
        "error_sql": "SELECT city, age, COUNT(*) FROM users GROUP BY city;",
        "error_message": "Error: column 'age' must appear in GROUP BY clause",
        "why_it_happens": "When grouping, any non-aggregated column in SELECT must be in GROUP BY.",
        "fix_sql": "SELECT city, age, COUNT(*) FROM users GROUP BY city, age;",
        "key_takeaway": "Include all non-aggregated columns in GROUP BY"
      }
    ],
    "practice_challenge": {
      "description": "Find cities that have more than 2 users, ordered by user count.",
      "hint": "Use GROUP BY with HAVING and ORDER BY.",
      "solution": "SELECT city, COUNT(*) as user_count\nFROM users\nGROUP BY city\nHAVING COUNT(*) > 2\nORDER BY user_count DESC;",
      "explanation": "GROUP BY groups users by city, HAVING filters groups with more than 2 users, and ORDER BY sorts the results."
    }
  },
  "metadata": {
    "difficulty": "intermediate",
    "estimated_time_minutes": 20,
    "source_chunks": 20
  }
}